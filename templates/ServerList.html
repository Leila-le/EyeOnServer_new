{% extends 'base.html' %}
{% load static %}
{% block Server_list %}

  <table class="layui-hide" id="test" lay-filter="test" ></table>

    <script type="text/html" id="barDemo">
      <div class="layui-clear-space">
        <a class="layui-btn layui-btn-xs" lay-event="system" >系统</a>
{#        <a class="layui-btn layui-btn-xs" lay-event="chart" >图表</a>#}
      </div>
    </script>
    <script src="{% static 'js/layui.js' %}"></script>
    <script src="{% static 'js/jquery-3.6.0.min.js' %}"></script>
    <script >
    layui.use(['table', 'layer'], function(){
      var table = layui.table;
      var layer = layui.layer;
      var laypage = layui.laypage;
      // 创建渲染实例
      table.render({
        elem: '#test',
        url:'/static/merger.json', // 此处为静态模拟数据，实际使用时需换成真实接口
        toolbar: '#toolbarDemo',
        defaultToolbar: ['filter', 'exports', 'print', {
          title: '提示',
          layEvent: 'LAYTABLE_TIPS',
          icon: 'layui-icon-tips'
        }],
        height: 'full-35', // 最大高度减去其他容器已占有得高度差
        css: [ // 重设当前表格样式
          '.layui-table-tool-temp{padding-right: 145px;}'
        ].join(''),
        cellMinWidth: 80,
        page: {
            layout:['count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip'],
            limits:[10,15,20],
        },
        cols: [[
          {type: 'checkbox', fixed: 'left'},
          {field: 'name',fixed: 'left', width:'10%', title: '系统', sort: true},
          {field:'license_name', width:'15%', title: '授权公司/名称', sort: true},
          {field:'memory', width:'10%', title: '内存%',sort: true},
          {field:'cpu', width:'10%', title: 'CPU%', sort: true},
          {field:'disk', width:'10%', title: '磁盘%', sort: true},
          {field:'ip', title:'IP', width: '15%'},
          {field:'joinTime', title:'更新时间', width: '10%',sort: true},
          {field:'remark',title:'备注<i class="layui-icon layui-icon-tips layui-font-14" lay-event="email-tips" title="该字段开启了编辑功能" style="margin-left: 5px;"></i>', hide: 0, width:'10%', edit: 'text'},
          {fixed: 'right', title:'操作', width: '10%', toolbar: '#barDemo'}
        ]],
          done:function (res,curr,count){
            $("table").css("width","100%");
            var dataCount = table.cache.myTableFilter.length;
            table.reload('#test',{
                count:dataCount
            });
          },
        error: function(res, msg){
          console.log(res, msg)
        }
      });
        // 触发单元格工具事件
      table.on('tool(test)', function(obj){ // 双击 toolDouble
        var data = obj.data; // 获得当前行数据
        // console.log(obj)
        if(obj.event === 'system'){
            $.ajax({
                url:'{% url "system" %}',
                type:'GET',
                data:{license_name:data.license_name},
                success:function (data){
                    window.location.href=this.url
                },
                error:function (xhr, status, error){
                    console.error("Error:", error);
                }
            });
        }
      });

      // 触发表格复选框选择
      table.on('checkbox(test)', function(obj){
        console.log(obj)
      });

      // 触发表格单选框选择
      table.on('radio(test)', function(obj){
        console.log(obj)
      });

    });
    </script>
{% endblock %}