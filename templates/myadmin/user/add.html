{% extends "myadmin/base.html" %}

{% block main_body %}
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <blockquote class="layui-elem-quote layui-text">
            账号管理
        <span class="layui-breadcrumb" lay-separator=">" >
          <a href="">首页</a>
          <a href="" class="active">账号信息管理</a>
        </span>
        </blockquote>
    </section>
    <!-- Main content -->
    <section class="content container-fluid">
      <div class="layui-row layui-col-space15">
        <div class="layui-col-md4">
          <div class="layui-card">
            <div class="layui-card-header">
                <h2 >添加员工账号信息</h2>
            </div>
            <!-- /.box-header -->
            <!-- form start -->
            <form class="layui-form" action="{% url 'myadmin_user_insert' %}" method="post" id="user-add-tset">
                {% csrf_token %}
              <div class="layui-card-body">
                <div class="layui-form-item">
                  <div class="layui-input-wrap">
                    <div class="layui-input-prefix">
                      <i class="layui-icon layui-icon-username"></i>
                    </div>
                      <input type="text" name="username" value="" lay-verify="required" placeholder="账号" autocomplete="off" class="layui-input" lay-affix="clear">
                  </div>
                </div>

                <div class="layui-form-item">
                  <div class="layui-input-wrap">
                    <div class="layui-input-prefix">
                      <i class="layui-icon layui-icon-username"></i>
                    </div>
                      <input type="text" name="nickname" value="" lay-verify="required" placeholder="昵称" autocomplete="off" class="layui-input" lay-affix="clear">
                  </div>
                </div>

                <div class="layui-form-item">
                  <div class="layui-input-wrap">
                    <div class="layui-input-prefix">
                      <i class="layui-icon layui-icon-password"></i>
                    </div>
                      <input type="password" name="password" value="" lay-verify="required" placeholder="密码" autocomplete="off" class="layui-input" id="reg-password" lay-affix="eye">
                  </div>
                </div>

                <div class="layui-form-item">
                  <div class="layui-input-wrap">
                    <div class="layui-input-prefix">
                      <i class="layui-icon layui-icon-password"></i>
                    </div>
                      <input type="password" name="confirmPassword" value="" lay-verify="required|confirmPassword" placeholder="确认密码" autocomplete="off" class="layui-input" lay-affix="eye">
                  </div>
                </div>
              </div>
              <!-- /.box-body -->
              <div class="box-footer">
                <div class="layui-box">
                  <button type="submit" class="layui-btn btn-primary">提交</button> &nbsp;
                  <button type="reset" class="layui-btn btn-default">重置</button>
                </div>
              </div>

            </form>
          </div>
        </div>
      </div>
    </section>
    <script src="//unpkg.com/layui@2.8.15/dist/layui.js"></script> 
<script>
layui.use(function() {
    let $ = layui.$;
    let form = layui.form;
    let layer = layui.layer;
    let util = layui.util;

    //提交事件
    form.on('submit(demo-login)', function(data) {
        let field = data.field; // 获取表单字段值
        let username = field.username;
        let password = field.password;
        let confirm_password = field.confirmPassword;

        if(username===''){
            layer.alert('请输入用户名！');
            return false;
        }else if (password === '') {
            console.log(2222)
            layer.alert('请输入密码！');
            return false;
        }

        //检查用户是否已存在
        $.ajax({
            url: '/myadmin_user_check_username/',
            type: 'POST',
            data: {
                'username': username
            },
            success: function(response) {
                if (response.exists) {
                    layer.alert('该用户名已存在！');
                } else {
                    // 提交表单
                    data.elem.submit();
                }
            },
            error: function() {
                layer.alert('请求失败，请重试！');
            }
        });
        return false;//阻止默认form跳转
    })
})
</script>
{% endblock %}