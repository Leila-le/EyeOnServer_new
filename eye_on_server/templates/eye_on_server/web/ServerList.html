{% extends 'web/base.html' %}
{% load static %}
{% block breadcrumb %}
  <span class="layui-breadcrumb" lay-separator=">" style="font-size: 32px">
  <a href="{% url 'ServerChart' %}">首页</a>
  <a href="{% url 'ServerList' %}">主机信息概览</a>
</span>
{% endblock %}
{% block Server_list %}

  <table class="layui-hide" id="test" lay-filter="test" ></table>

    <script type="text/html" id="barDemo">
      <div class="layui-clear-space">
        <a class="layui-btn layui-btn-xs" lay-event="system" >系统</a>
{#        <a class="layui-btn layui-btn-xs" lay-event="chart" >图表</a>#}
      </div>
    </script>
    <script src="{% static 'eye_on_server/js/layui.js' %}"></script>
    <script src="{% static 'eye_on_server/js/jquery-3.6.0.min.js' %}"></script>
    <script >
    layui.use(['table', 'layer'], function(){
      var table = layui.table;

      // 创建渲染实例
      table.render({
        elem: '#test',
        url:'{% url 'table_data' %}',
        toolbar: '#toolbarDemo',
        defaultToolbar: ['filter', 'exports', 'print', {
          title: '提示',
          layEvent: 'LAYTABLE_TIPS',
          icon: 'layui-icon-tips'
        }],
        height: 'full-35', // 最大高度减去其他容器已占有得高度差
        page: true, // 是否显示分页
        limit:5,
        limits:[5,10,15],
        cols: [[
          {type: 'checkbox', fixed: 'left'},
          {field: 'name',fixed: 'left', width:'10%', title: '系统', sort: true},
          {field:'license_name', width:'15%', title: '授权公司/名称', sort: true},
          {field:'memory', width:'10%', title: '内存%',sort: true},
          {field:'cpu', width:'10%', title: 'CPU%', sort: true},
          {field:'disk', width:'10%', title: '磁盘%', sort: true},
          {field:'ip', title:'IP', width: '15%'},
          {field:'joinTime', title:'更新时间', width: '10%',sort: true},
          {#{field:'remark',title:'备注<i class="layui-icon layui-icon-tips layui-font-14" lay-event="email-tips" title="该字段开启了编辑功能" style="margin-left: 5px;"></i>', hide: 0, width:'10%', edit: 'text'},#}
          {fixed: 'right', title:'操作', width: '10%', toolbar: '#barDemo'}
        ]],
          done:function (res,curr,count){
            console.log(res); // 检查数据是否正确
          },
        error: function(res, msg){
          console.log(res, msg)
        }
      });
        // 触发单元格工具事件
      table.on('tool(test)', function(obj){ // 双击 toolDouble
        var data = obj.data; // 获得当前行数据
        // console.log(obj)
        if(obj.event === 'system'){
            $.ajax({
                url:'{% url "system" %}',
                type:'GET',
                data:{license_name:data.license_name},
                success:function (data){
                    window.location.href=this.url
                },
                error:function (xhr, status, error){
                    console.error("Error:", error);
                }
            });
        }
      });
      {#table.on('edit(test)', function(obj){ //注：edit是固定事件名，test是table原始容器的属性 lay-filter="对应的值"#}
      {#    console.log(obj.value); //得到修改后的值#}
      {#    console.log(obj.field); //当前编辑的字段名#}
      {#    console.log(obj.data); //所在行的所有相关数据#}
      {#    $.ajax({#}
      {#        url:'{% url 'remark' %}',#}
      {#        type:'POST',#}
      {#        data:{'value':obj.value,'license_name':obj.data.license_name,'name':obj.data.name},#}
      {#        success:function (data){#}
      {#            layer.msg('编辑成功', {icon: 1});#}
      {#        },#}
      {#        error:function (xhr, status, error){#}
      {#              console.error("Error:", error);#}
      {#        }#}
      {#    })#}

      {# });#}

      // 触发表格复选框选择
      table.on('checkbox(test)', function(obj){
        console.log(obj)
      });

      // 触发表格单选框选择
      table.on('radio(test)', function(obj){
        console.log(obj)
      });
    });
    </script>
{% endblock %}